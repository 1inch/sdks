# name: Publish

# on:
#   push:
#     tags:
#       - '*/v*.*.*'
#   workflow_dispatch:
#     inputs:
#       tag:
#         type: string
#         description: Tag to publish (e.g. aqua/v1.2.3)
#         required: true

# permissions:
#   contents: read
#   packages: write

# jobs:
#   determine:
#     runs-on: ubuntu-latest
#     outputs:
#       tag: ${{ steps.tag.outputs.value }}
#       project: ${{ steps.project.outputs.value }}
#       sdk_path: ${{ steps.project.outputs.sdk_path }}
#     steps:
#       - id: tag
#         run: |
#           if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
#             echo "value=${{ inputs.tag }}" >> "$GITHUB_OUTPUT"
#           else
#             echo "value=${GITHUB_REF_NAME}" >> "$GITHUB_OUTPUT"
#           fi

#       - id: project
#         run: |
#           TAG="${{ steps.tag.outputs.value }}"

#           case "$TAG" in
#             aqua/v*) PROJECT="aqua" ;;
#             sdk-core/v*) PROJECT="sdk-core" ;;
#             swap-vm/v*) PROJECT="swap-vm" ;;
#             *)
#               echo "Unknown tag pattern: $TAG"
#               exit 1
#               ;;
#           esac

#           echo "value=$PROJECT" >> "$GITHUB_OUTPUT"
#           echo "sdk_path=typescript/$PROJECT" >> "$GITHUB_OUTPUT"

#   publish:
#     needs: determine
#     runs-on: ubuntu-latest
#     permissions:
#       contents: read
#       packages: write
#     steps:
#       - name: Checkout
#         uses: actions/checkout@v4
#         with:
#           ref: ${{ needs.determine.outputs.tag }}
#           fetch-depth: 0

#       - name: Install pnpm
#         uses: pnpm/action-setup@v4

#       - name: Setup Node
#         uses: actions/setup-node@v4
#         with:
#           node-version: 22
#           cache: pnpm
#           registry-url: https://registry.npmjs.org
#           always-auth: true

#       - name: Install dependencies
#         run: pnpm install --frozen-lockfile

#       - name: Build
#         run: npx nx build ${{ needs.determine.outputs.project }}

#       - name: Publish to npmjs
#         env:
#           NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
#         run: |
#           SDK_PATH=${{ needs.determine.outputs.sdk_path }}
#           cd "$SDK_PATH/dist"

#           TAG_ARG=""
#           VERSION=$(node -p "require('../package.json').version")
#           if [[ "$VERSION" == *"-rc"* ]]; then
#             TAG_ARG="--tag next"
#           fi

#           npm publish --access public $TAG_ARG

#       - name: Publish to GitHub Packages
#         env:
#           NODE_AUTH_TOKEN: ${{ github.token }}
#         run: |
#           SDK_PATH=${{ needs.determine.outputs.sdk_path }}
#           cd "$SDK_PATH/dist"

#           npm config set @1inch:registry https://npm.pkg.github.com
#           npm config set //npm.pkg.github.com/:_authToken "${NODE_AUTH_TOKEN}"
#           npm publish --access public
